import {
  Box,
  Button,
  Container,
  FormControl,
  FormErrorMessage,
  FormLabel,
  Grid,
  GridItem,
  Heading,
  Icon,
  Input,
  Modal,
  ModalBody,
  ModalCloseButton,
  ModalContent,
  ModalFooter,
  ModalHeader,
  ModalOverlay,
  Spinner,
  Text,
  Textarea,
  VStack,
  useDisclosure,
  useToast,
} from "@chakra-ui/react";
import { useState } from "react";
import { MdStarRate, MdCall } from "react-icons/md";
import { submitLead, LeadData } from "../../api/leads.service";
import { formatPhone, isValidPhone } from "../../utils/masks";\n\nconst LeadForm = () => {\n  const { isOpen, onOpen, onClose } = useDisclosure();\n  const [isLoading, setIsLoading] = useState(false);\n  const [formData, setFormData] = useState<LeadData>({\n    full_name: \"\",\n    email: \"\",\n    phone: \"\",\n  });\n  const [errors, setErrors] = useState<Record<string, string>>();\n  const toast = useToast();\n\n  const handleChange = (\n    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n  ) => {\n    const { name, value } = e.target;\n    let finalValue = value;\n\n    // Aplicar máscara telefone\n    if (name === \"phone\") {\n      finalValue = formatPhone(value);\n    }\n\n    setFormData({ ...formData, [name]: finalValue });\n\n    // Limpar erro ao digitar\n    if (errors && errors[name]) {\n      setErrors({ ...errors, [name]: \"\" });\n    }\n  };\n\n  const validateForm = (): boolean => {\n    const newErrors: Record<string, string> = {};\n\n    if (!formData.full_name.trim()) {\n      newErrors.full_name = \"Nome é obrigatório\";\n    }\n\n    if (!formData.email.trim()) {\n      newErrors.email = \"Email é obrigatório\";\n    } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n      newErrors.email = \"Email inválido\";\n    }\n\n    if (!formData.phone.trim()) {\n      newErrors.phone = \"Telefone é obrigatório\";\n    } else if (!isValidPhone(formData.phone)) {\n      newErrors.phone = \"Telefone deve ter 10 ou 11 dígitos\";\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!validateForm()) {\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      await submitLead(formData);\n      onOpen();\n      setFormData({ full_name: \"\", email: \"\", phone: \"\" });\n    } catch (error: any) {\n      const errorMessage =\n        error.response?.data?.detail || \"Erro ao enviar solicitação. Tente novamente.\";\n      toast({\n        title: \"Erro\",\n        description: errorMessage,\n        status: \"error\",\n        duration: 5000,\n        isClosable: true,\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleCloseModal = () => {\n    onClose();\n    window.scrollTo({ top: 0, behavior: \"smooth\" });\n  };\n\n  return (\n    <>\n      <Box id=\"lead\" layerStyle=\"section\" bg=\"midnight.900\">\n        <Container maxW=\"1200px\">\n          <Grid\n            templateColumns={{ base: \"1fr\", lg: \"1fr 1fr\" }}\n            gap={{ base: 8, md: 12 }}\n            alignItems=\"center\"\n          >\n            {/* Testimonial */}\n            <VStack align=\"flex-start\" spacing={6}>\n              <Box display=\"flex\" gap={1} color=\"gold.600\">\n                {[...Array(5)].map((_, i) => (\n                  <Icon key={i} as={MdStarRate} boxSize={5} />\n                ))}\n              </Box>\n\n              <Text\n                fontSize={{ base: \"lg\", md: \"xl\" }}\n                fontFamily=\"heading\"\n                color=\"white\"\n                lineHeight={1.6}\n                fontWeight={500}\n              >\n                \"Ótimo serviço de aluguel! O carro estava em perfeitas condições e o\n                motorista foi muito profissional.\"\n              </Text>\n\n              <VStack align=\"flex-start\" spacing={1}>\n                <Text fontWeight=\"bold\" color=\"white\" fontSize=\"md\">\n                  Ana R.\n                </Text>\n                <Text\n                  fontSize=\"xs\"\n                  color=\"gold.600\"\n                  letterSpacing=\"0.05em\"\n                  fontWeight={600}\n                  textTransform=\"uppercase\"\n                >\n                  Cliente Executiva\n                </Text>\n              </VStack>\n\n              <Box\n                p={6}\n                bg=\"whiteAlpha.5\"\n                border=\"1px solid\"\n                borderColor=\"whiteAlpha.100\"\n                rounded=\"lg\"\n                display=\"flex\"\n                gap={4}\n                align=\"flex-start\"\n              >\n                <Box\n                  w={12}\n                  h={12}\n                  bg=\"gold.600\"\n                  rounded=\"md\"\n                  display=\"flex\"\n                  alignItems=\"center\"\n                  justifyContent=\"center\"\n                  flexShrink={0}\n                >\n                  <Icon as={MdCall} color=\"midnight.900\" boxSize={6} />\n                </Box>\n                <VStack align=\"flex-start\" spacing={0}>\n                  <Text fontSize=\"2xs\" color=\"whiteAlpha.600\" letterSpacing=\"0.1em\" fontWeight={600}>\n                    Fone uma ligação?\n                  </Text>\n                  <Text fontSize=\"sm\" color=\"white\" mt={2}>\n                    Av. Exemplo, 723 • Manaus, AM\n                  </Text>\n                </VStack>\n              </Box>\n            </VStack>\n\n            {/* Form */}\n            <Box\n              bg=\"midnight.800\"\n              border=\"1px solid\"\n              borderColor=\"whiteAlpha.100\"\n              p={{ base: 6, md: 8 }}\n              rounded=\"xl\"\n              boxShadow=\"0 0 30px rgba(0, 0, 0, 0.3)\"\n            >\n              <VStack spacing={6} align=\"stretch\">\n                <Heading textStyle=\"h3\" color=\"white\" textTransform=\"uppercase\">\n                  Contacte\n                </Heading>\n\n                <form onSubmit={handleSubmit} style={{ width: \"100%\" }}>\n                  <VStack spacing={5}>\n                    <FormControl isInvalid={!!errors?.full_name}>\n                      <FormLabel fontSize=\"sm\" fontWeight={600} color=\"whiteAlpha.800\">\n                        Nome Completo\n                      </FormLabel>\n                      <Input\n                        name=\"full_name\"\n                        placeholder=\"Seu nome\"\n                        value={formData.full_name}\n                        onChange={handleChange}\n                        px={4}\n                        py={2.5}\n                        fontSize=\"sm\"\n                      />\n                      <FormErrorMessage fontSize=\"xs\" mt={1}>\n                        {errors?.full_name}\n                      </FormErrorMessage>\n                    </FormControl>\n\n                    <FormControl isInvalid={!!errors?.email}>\n                      <FormLabel fontSize=\"sm\" fontWeight={600} color=\"whiteAlpha.800\">\n                        Email\n                      </FormLabel>\n                      <Input\n                        name=\"email\"\n                        type=\"email\"\n                        placeholder=\"seu.email@exemplo.com\"\n                        value={formData.email}\n                        onChange={handleChange}\n                        px={4}\n                        py={2.5}\n                        fontSize=\"sm\"\n                      />\n                      <FormErrorMessage fontSize=\"xs\" mt={1}>\n                        {errors?.email}\n                      </FormErrorMessage>\n                    </FormControl>\n\n                    <FormControl isInvalid={!!errors?.phone}>\n                      <FormLabel fontSize=\"sm\" fontWeight={600} color=\"whiteAlpha.800\">\n                        Telefone\n                      </FormLabel>\n                      <Input\n                        name=\"phone\"\n                        placeholder=\"(92) 99999-9999\"\n                        value={formData.phone}\n                        onChange={handleChange}\n                        px={4}\n                        py={2.5}\n                        fontSize=\"sm\"\n                      />\n                      <FormErrorMessage fontSize=\"xs\" mt={1}>\n                        {errors?.phone}\n                      </FormErrorMessage>\n                    </FormControl>\n\n                    <Button\n                      type=\"submit\"\n                      variant=\"primary\"\n                      w=\"full\"\n                      py={3}\n                      fontSize=\"sm\"\n                      letterSpacing=\"0.05em\"\n                      isLoading={isLoading}\n                      loadingText=\"Enviando...\"\n                    >\n                      Enviar\n                    </Button>\n                  </VStack>\n                </form>\n              </VStack>\n            </Box>\n          </Grid>\n        </Container>\n      </Box>\n\n      {/* Success Modal */}\n      <Modal isOpen={isOpen} onClose={handleCloseModal} isCentered>\n        <ModalOverlay backdropFilter=\"blur(10px)\" />\n        <ModalContent bg=\"midnight.800\" borderColor=\"gold.600\" border=\"1px solid\">\n          <ModalHeader\n            color=\"gold.600\"\n            textAlign=\"center\"\n            textTransform=\"uppercase\"\n            letterSpacing=\"0.1em\"\n            borderBottomColor=\"whiteAlpha.100\"\n            borderBottomWidth=\"1px\"\n          >\n            Solicitação Confirmada\n          </ModalHeader>\n          <ModalCloseButton color=\"gold.600\" _hover={{ bg: \"whiteAlpha.100\" }} />\n          <ModalBody py={8}>\n            <VStack spacing={4}>\n              <Box fontSize=\"3xl\" textAlign=\"center\">\n                ✓\n              </Box>\n              <Text textAlign=\"center\" color=\"white\" fontSize=\"md\" lineHeight={1.6}>\n                Agradecemos o interesse na frota Podium. Um de nossos consultores de\n                blindados entrará em contato em breve para apresentar a proposta.\n              </Text>\n            </VStack>\n          </ModalBody>\n          <ModalFooter\n            borderTopColor=\"whiteAlpha.100\"\n            borderTopWidth=\"1px\"\n            justifyContent=\"center\"\n          >\n            <Button\n              variant=\"primary\"\n              onClick={handleCloseModal}\n              w=\"full\"\n              letterSpacing=\"0.05em\"\n            >\n              Voltar ao Início\n            </Button>\n          </ModalFooter>\n        </ModalContent>\n      </Modal>\n    </>\n  );\n};\n\nexport default LeadForm;